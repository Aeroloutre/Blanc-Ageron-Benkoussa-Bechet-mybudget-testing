<div class="details-container" *ngIf="category && !loading">
  <div class="header">
    <button class="btn-back" routerLink="/categories">← Retour</button>
    <div class="title-section">
      <h1 *ngIf="!isEditingName">{{ category.label }}</h1>
      <input 
        *ngIf="isEditingName" 
        type="text" 
        [(ngModel)]="editedName" 
        (blur)="saveCategoryName()" 
        (keyup.enter)="saveCategoryName()" 
        (keyup.escape)="cancelEdit()" 
        class="edit-input"
        #nameInput
      />
      <button class="btn-edit" (click)="toggleEditName()" title="Modifier le nom">
        <img src="modification-du-stylo.png" alt="Modifier" />
      </button>
    </div>
  </div>

  <div class="category-summary">
    <div class="summary-card">
      <h3>Total revenus</h3>
      <p class="amount positive">+{{ totalAjouts.toFixed(2) }} €</p>
    </div>
    <div class="summary-card">
      <h3>Total dépenses</h3>
      <p class="amount negative">-{{ totalRetraits.toFixed(2) }} €</p>
    </div>
    <div class="summary-card">
      <h3>Solde</h3>
      <p class="amount" [class.positive]="solde >= 0" [class.negative]="solde < 0">
        {{ solde >= 0 ? '+' : '' }}{{ solde.toFixed(2) }} €
      </p>
    </div>
  </div>

  <div class="transactions-section">
    <div class="transactions-header">
      <h2>Transactions</h2>
      <button class="btn-add-transaction" (click)="ajouterTransaction()">+ Ajouter une transaction</button>
    </div>
    
    <div class="transactions-list" *ngIf="transactions.length > 0; else noTransactions">
      <div class="transaction-item" 
           *ngFor="let transaction of transactions" 
           (click)="voirDetailsTransaction(transaction.transaction_id!)"
           [class.ajout]="transaction.type === 'income'" 
           [class.retrait]="transaction.type === 'expense'">
        <button class="btn-delete-transaction" (click)="supprimerTransaction(transaction.transaction_id!, $event)" title="Supprimer la transaction">
          <img src="fermer.png" alt="Supprimer" />
        </button>
        <div class="transaction-info">
          <div class="transaction-label">{{ transaction.label || 'Sans libellé' }}</div>
          <div class="transaction-date">{{ transaction.transaction_date | date:'dd/MM/yyyy' }}</div>
        </div>
        <div class="transaction-details">
          <span class="transaction-type" [class.type-ajout]="transaction.type === 'income'" 
                [class.type-retrait]="transaction.type === 'expense'">
            {{ transaction.type === 'income' ? 'Revenu' : 'Dépense' }}
          </span>
          <span class="transaction-amount" [class.positive]="transaction.type === 'income'" 
                [class.negative]="transaction.type === 'expense'">
            {{ transaction.type === 'income' ? '+' : '-' }}{{ transaction.amount }} €
          </span>
        </div>
      </div>
    </div>

    <ng-template #noTransactions>
      <p class="no-transactions">Aucune transaction pour cette catégorie.</p>
    </ng-template>
  </div>
</div>

<div class="loading-container" *ngIf="loading">
  <p>Chargement...</p>
</div>

<div class="error-container" *ngIf="error">
  <h2>{{ error }}</h2>
  <button class="btn-back" routerLink="/categories">← Retour aux catégories</button>
</div>

<div class="error-container" *ngIf="!category && !loading && !error">
  <h2>Catégorie non trouvée</h2>
  <button class="btn-back" routerLink="/categories">← Retour aux catégories</button>
</div>
