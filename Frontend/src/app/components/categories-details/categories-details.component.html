<div class="details-container" *ngIf="category && !loading">
  <div class="header">
    <button class="btn-back" routerLink="/categories">← Retour</button>
    
    <div class="header-content">
      <!-- Section nom de la catégorie -->
      <div class="category-name-card">
        <div class="card-content">
          <div class="card-header">
            <span class="card-label">Catégorie</span>
            <button class="btn-edit-inline" (click)="toggleEditName()" title="Modifier le nom" *ngIf="!isEditingName">
              <img src="modification-du-stylo.png" alt="Modifier" />
            </button>
          </div>
          <div class="card-body">
            <h1 *ngIf="!isEditingName">{{ category.label }}</h1>
            <input 
              *ngIf="isEditingName" 
              type="text" 
              [(ngModel)]="editedName" 
              (blur)="saveCategoryName()" 
              (keyup.enter)="saveCategoryName()" 
              (keyup.escape)="cancelEdit()" 
              class="input-field input-name"
              placeholder="Nom de la catégorie"
              #nameInput
            />
          </div>
        </div>
      </div>

      <!-- Section budget -->
      <div class="budget-card">
        <div class="card-content">
          <div class="card-header">
            <span class="card-label">Budget alloué</span>
            <button class="btn-edit-inline" (click)="toggleEditBudget()" [title]="budget ? 'Modifier le budget' : 'Allouer un budget'" *ngIf="!isEditingBudget && budget">
              <img src="modification-du-stylo.png" alt="Modifier" />
            </button>
          </div>
          
          <!-- Affichage du budget existant -->
          <div class="card-body" *ngIf="!isEditingBudget && budget">
            <div class="budget-amount">{{ budget.allocated_amount }} €</div>
            <div class="budget-period">
              <span class="period-label">Période:</span>
              <span class="period-dates">{{ budget.period_start | date:'dd/MM/yyyy' }} - {{ budget.period_end | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>

          <!-- Pas de budget alloué -->
          <div class="card-body no-budget" *ngIf="!isEditingBudget && !budget">
            <p class="no-budget-message">Aucun budget alloué</p>
            <button class="btn-allocate-budget" (click)="toggleEditBudget()">+ Allouer un budget</button>
          </div>

          <!-- Formulaire de création/modification -->
          <div class="card-body budget-edit-form" *ngIf="isEditingBudget">
            <div class="form-field">
              <label>Montant (€)</label>
              <input 
                type="number" 
                [(ngModel)]="editedBudgetAmount" 
                min="0"
                step="0.01"
                class="input-field"
                placeholder="0.00"
                #budgetInput
              />
            </div>
            <div class="form-row">
              <div class="form-field">
                <label>Début</label>
                <input 
                  type="date" 
                  [(ngModel)]="editedPeriodStart" 
                  class="input-field input-date"
                />
              </div>
              <div class="form-field">
                <label>Fin</label>
                <input 
                  type="date" 
                  [(ngModel)]="editedPeriodEnd" 
                  class="input-field input-date"
                />
              </div>
            </div>
            <div class="form-actions">
              <button class="btn-save" (click)="saveBudget()">✓ Sauvegarder</button>
              <button class="btn-cancel" (click)="cancelEditBudget()">✕ Annuler</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="category-summary">
    <div class="summary-card">
      <h3>Total revenus</h3>
      <p class="amount positive">+{{ totalAjouts.toFixed(2) }} €</p>
    </div>
    <div class="summary-card">
      <h3>Total dépenses</h3>
      <p class="amount negative">-{{ totalRetraits.toFixed(2) }} €</p>
    </div>
    <div class="summary-card">
      <h3>Solde</h3>
      <p class="amount" [class.positive]="solde >= 0" [class.negative]="solde < 0">
        {{ solde >= 0 ? '+' : '' }}{{ solde.toFixed(2) }} €
      </p>
    </div>
  </div>

  <div class="transactions-section">
    <div class="transactions-header">
      <h2>Transactions</h2>
      <button class="btn-add-transaction" (click)="addTransaction()">+ Ajouter une transaction</button>
    </div>
    
    <div class="transactions-list" *ngIf="transactions.length > 0; else noTransactions">
      <div class="transaction-item" 
           *ngFor="let transaction of transactions" 
           (click)="seeDetailsTransaction(transaction.transaction_id!)"
           [class.ajout]="transaction.type === 'income'" 
           [class.retrait]="transaction.type === 'expense'">
        <button class="btn-delete-transaction" (click)="supprimerTransaction(transaction.transaction_id!, $event)" title="Supprimer la transaction">
          <img src="fermer.png" alt="Supprimer" />
        </button>
        <div class="transaction-info">
          <div class="transaction-label">{{ transaction.label || 'Sans libellé' }}</div>
          <div class="transaction-date">{{ transaction.transaction_date | date:'dd/MM/yyyy' }}</div>
        </div>
        <div class="transaction-details">
          <span class="transaction-type" [class.type-ajout]="transaction.type === 'income'" 
                [class.type-retrait]="transaction.type === 'expense'">
            {{ transaction.type === 'income' ? 'Revenu' : 'Dépense' }}
          </span>
          <span class="transaction-amount" [class.positive]="transaction.type === 'income'" 
                [class.negative]="transaction.type === 'expense'">
            {{ transaction.type === 'income' ? '+' : '-' }}{{ transaction.amount }} €
          </span>
        </div>
      </div>
    </div>

    <ng-template #noTransactions>
      <p class="no-transactions">Aucune transaction pour cette catégorie.</p>
    </ng-template>
  </div>
</div>

<div class="loading-container" *ngIf="loading">
  <p>Chargement...</p>
</div>

<div class="error-container" *ngIf="error">
  <h2>{{ error }}</h2>
  <button class="btn-back" routerLink="/categories">← Retour aux catégories</button>
</div>

<div class="error-container" *ngIf="!category && !loading && !error">
  <h2>Catégorie non trouvée</h2>
  <button class="btn-back" routerLink="/categories">← Retour aux catégories</button>
</div>
